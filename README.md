# Backend Forge

> åŸºäº Fastify + TypeScript çš„ç”Ÿäº§çº§åç«¯é¡¹ç›®è„šæ‰‹æ¶
> A production-ready Fastify + TypeScript backend scaffold for quickly forging modern Node.js services

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Node.js Version](https://img.shields.io/badge/node-%3E%3D20.0.0-brightgreen.svg)](https://nodejs.org/)
[![TypeScript](https://img.shields.io/badge/TypeScript-5.3-blue.svg)](https://www.typescriptlang.org/)

## âœ¨ ç‰¹æ€§

- ğŸš€ **é«˜æ€§èƒ½**: åŸºäº Fastifyï¼Œæä¾›å“è¶Šçš„æ€§èƒ½è¡¨ç°
- ğŸ“˜ **TypeScript**: å®Œæ•´çš„ TypeScript æ”¯æŒï¼Œä¸¥æ ¼çš„ç±»å‹æ£€æŸ¥
- ğŸ—ï¸ **æ¨¡å—åŒ–æ¶æ„**: åŠŸèƒ½æ¨¡å—åŒ–ç»„ç»‡ï¼Œæ˜“äºæ‰©å±•å’Œç»´æŠ¤
- âœ… **ç¯å¢ƒå˜é‡æ ¡éªŒ**: å¯åŠ¨æ—¶è‡ªåŠ¨æ ¡éªŒé…ç½®ï¼ŒFail Fast æœºåˆ¶
- ğŸ“ **ç»Ÿä¸€å“åº”æ ¼å¼**: æ ‡å‡†åŒ–çš„ API å“åº”ç»“æ„
- ğŸ›¡ï¸ **å…¨å±€é”™è¯¯å¤„ç†**: é›†ä¸­å¼é”™è¯¯å¤„ç†ï¼Œè¯­ä¹‰åŒ– HTTP çŠ¶æ€ç 
- ğŸ“š **è‡ªåŠ¨ API æ–‡æ¡£**: é›†æˆ Swagger/OpenAPIï¼Œè‡ªåŠ¨ç”Ÿæˆäº¤äº’å¼æ–‡æ¡£
- ğŸ§ª **æµ‹è¯•å°±ç»ª**: å†…ç½® Vitest æµ‹è¯•æ¡†æ¶å’Œç¤ºä¾‹æµ‹è¯•
- ğŸ¯ **ç”Ÿäº§å°±ç»ª**: éµå¾ªæœ€ä½³å®è·µï¼Œå¯ç›´æ¥ç”¨äºç”Ÿäº§ç¯å¢ƒ

## ğŸ“‹ æŠ€æœ¯æ ˆ

- **è¿è¡Œæ—¶**: Node.js >= 20
- **åŒ…ç®¡ç†å™¨**: pnpm >= 8
- **Web æ¡†æ¶**: Fastify 4.x
- **ç¼–ç¨‹è¯­è¨€**: TypeScript 5.x
- **æ ¡éªŒåº“**: Zod
- **æµ‹è¯•æ¡†æ¶**: Vitest
- **ä»£ç è§„èŒƒ**: ESLint + TypeScript ESLint

## ğŸ“ ç›®å½•ç»“æ„

```
backend-forge/
â”œâ”€â”€ src/                          # æºä»£ç æ ¹ç›®å½•
â”‚   â”œâ”€â”€ config/                  # é…ç½®ç®¡ç†å±‚
â”‚   â”‚   â”œâ”€â”€ env.ts              # ç¯å¢ƒå˜é‡æ ¡éªŒï¼ˆZodï¼‰
â”‚   â”‚   â””â”€â”€ index.ts            # é…ç½®èšåˆå¯¼å‡º
â”‚   â”‚
â”‚   â”œâ”€â”€ types/                   # TypeScript ç±»å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ fastify.d.ts        # Fastify ç±»å‹æ‰©å±•
â”‚   â”‚   â”œâ”€â”€ response.ts         # å“åº”ç»“æ„ç±»å‹
â”‚   â”‚   â””â”€â”€ index.ts            # ç±»å‹å¯¼å‡º
â”‚   â”‚
â”‚   â”œâ”€â”€ plugins/                 # Fastify æ’ä»¶
â”‚   â”‚   â”œâ”€â”€ response.ts         # ç»Ÿä¸€å“åº”æ ¼å¼æ’ä»¶
â”‚   â”‚   â”œâ”€â”€ error-handler.ts    # å…¨å±€é”™è¯¯å¤„ç†æ’ä»¶
â”‚   â”‚   â””â”€â”€ swagger.ts          # Swagger/OpenAPI æ’ä»¶
â”‚   â”‚
â”‚   â”œâ”€â”€ routes/                  # å…¨å±€è·¯ç”±ï¼ˆéä¸šåŠ¡ï¼‰
â”‚   â”‚   â”œâ”€â”€ health.ts           # å¥åº·æ£€æŸ¥è·¯ç”±
â”‚   â”‚   â””â”€â”€ index.ts            # è·¯ç”±èšåˆ
â”‚   â”‚
â”‚   â”œâ”€â”€ modules/                 # ä¸šåŠ¡æ¨¡å—ï¼ˆåŠŸèƒ½æ¨¡å—åŒ–ï¼‰â­
â”‚   â”‚   â”œâ”€â”€ user/               # ç”¨æˆ·æ¨¡å—ç¤ºä¾‹
â”‚   â”‚   â”‚   â”œâ”€â”€ user.controller.ts  # æ§åˆ¶å™¨å±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ user.service.ts     # æœåŠ¡å±‚ï¼ˆä¸šåŠ¡é€»è¾‘ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ user.route.ts       # è·¯ç”±å®šä¹‰
â”‚   â”‚   â”‚   â”œâ”€â”€ user.schema.ts      # JSON Schema
â”‚   â”‚   â”‚   â””â”€â”€ index.ts            # æ¨¡å—å¯¼å‡º
â”‚   â”‚   â””â”€â”€ index.ts            # æ¨¡å—èšåˆä¸è‡ªåŠ¨æ³¨å†Œ
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/                   # å·¥å…·å‡½æ•°
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ app.ts                   # Fastify åº”ç”¨å·¥å‚
â”‚   â””â”€â”€ server.ts                # æœåŠ¡å¯åŠ¨å…¥å£
â”‚
â”œâ”€â”€ tests/                       # æµ‹è¯•ç›®å½•
â”‚   â”œâ”€â”€ routes/                 # è·¯ç”±æµ‹è¯•
â”‚   â”œâ”€â”€ modules/                # æ¨¡å—æµ‹è¯•
â”‚   â””â”€â”€ plugins/                # æ’ä»¶æµ‹è¯•
â”‚
â”œâ”€â”€ .env.example                 # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â””â”€â”€ README.md
```

### ğŸ¯ ç›®å½•èŒè´£è¯´æ˜

#### `modules/` - åŠŸèƒ½æ¨¡å—åŒ–æ¶æ„ â­

æœ¬è„šæ‰‹æ¶é‡‡ç”¨ **åŠŸèƒ½æ¨¡å—åŒ–ï¼ˆVertical Slicingï¼‰** æ¶æ„ï¼Œæ¯ä¸ªä¸šåŠ¡æ¨¡å—ç‹¬ç«‹ç»„ç»‡ï¼š

```
modules/user/
â”œâ”€â”€ user.controller.ts    # æ§åˆ¶å™¨ï¼šå¤„ç† HTTP è¯·æ±‚/å“åº”
â”œâ”€â”€ user.service.ts       # æœåŠ¡å±‚ï¼šä¸šåŠ¡é€»è¾‘å¤„ç†
â”œâ”€â”€ user.route.ts         # è·¯ç”±å®šä¹‰ï¼šæ³¨å†Œè·¯ç”±
â””â”€â”€ user.schema.ts        # Schemaï¼šå‚æ•°æ ¡éªŒå’Œæ–‡æ¡£ç”Ÿæˆ
```

**ä¼˜åŠ¿**ï¼š
- âœ… é«˜å†…èšï¼šä¸€ä¸ªåŠŸèƒ½çš„æ‰€æœ‰ä»£ç åœ¨åŒä¸€ç›®å½•
- âœ… æ˜“æ‰©å±•ï¼šæ–°å¢æ¨¡å—åªéœ€å¤åˆ¶ç›®å½•ç»“æ„
- âœ… æ˜“åˆ é™¤ï¼šåˆ é™¤æ¨¡å—åªéœ€åˆ é™¤å¯¹åº”ç›®å½•
- âœ… å›¢é˜Ÿåä½œï¼šå‡å°‘ Git å†²çª

#### `routes/` vs `modules/`

- **`routes/`**: å­˜æ”¾å…¨å±€/åŸºç¡€è·¯ç”±ï¼ˆå¥åº·æ£€æŸ¥ã€ç›‘æ§ã€æ–‡æ¡£ç­‰ï¼‰
- **`modules/`**: å­˜æ”¾ä¸šåŠ¡æ¨¡å—è·¯ç”±ï¼ˆç”¨æˆ·ã€è®¢å•ã€å•†å“ç­‰ï¼‰

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1ï¸âƒ£ ç¯å¢ƒè¦æ±‚

ç¡®ä¿æ‚¨çš„ç³»ç»Ÿå·²å®‰è£…ï¼š

- Node.js >= 20
- pnpm >= 8

### 2ï¸âƒ£ å®‰è£…ä¾èµ–

```bash
# ä½¿ç”¨ pnpm å®‰è£…ä¾èµ–
pnpm install
```

### 3ï¸âƒ£ é…ç½®ç¯å¢ƒå˜é‡

```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡ç¤ºä¾‹æ–‡ä»¶
cp .env.example .env

# æ ¹æ®éœ€è¦ä¿®æ”¹ .env æ–‡ä»¶
```

### 4ï¸âƒ£ å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
# å¼€å‘æ¨¡å¼ï¼ˆçƒ­é‡è½½ï¼‰
pnpm dev
```

æœåŠ¡å¯åŠ¨åï¼Œæ‚¨å°†çœ‹åˆ°ï¼š

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                       â•‘
â•‘   ğŸš€ Backend Forge Server Started Successfully!      â•‘
â•‘                                                       â•‘
â•‘   Environment: development                            â•‘
â•‘   Address:     http://0.0.0.0:3000                    â•‘
â•‘   API Prefix:  /api                                   â•‘
â•‘                                                       â•‘
â•‘   ğŸ“š Swagger UI: http://localhost:3000/docs           â•‘
â•‘                                                       â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### 5ï¸âƒ£ è®¿é—® API

- **å¥åº·æ£€æŸ¥**: http://localhost:3000/health
- **API æ–‡æ¡£**: http://localhost:3000/docs
- **ç¤ºä¾‹æ¥å£**: http://localhost:3000/api/users

## ğŸ› ï¸ å¯ç”¨å‘½ä»¤

```bash
# å¼€å‘æ¨¡å¼ï¼ˆçƒ­é‡è½½ï¼‰
pnpm dev

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
pnpm build

# è¿è¡Œç”Ÿäº§ç‰ˆæœ¬
pnpm start

# è¿è¡Œæµ‹è¯•
pnpm test

# è¿è¡Œæµ‹è¯•ï¼ˆè¦†ç›–ç‡ï¼‰
pnpm test:coverage

# ä»£ç æ£€æŸ¥
pnpm lint

# ä»£ç æ£€æŸ¥å¹¶è‡ªåŠ¨ä¿®å¤
pnpm lint:fix
```

## ğŸ“ æ ¸å¿ƒæ¦‚å¿µ

### 1. ç¯å¢ƒå˜é‡æ ¡éªŒï¼ˆFail Fastï¼‰

ä½¿ç”¨ Zod åœ¨å¯åŠ¨æ—¶æ ¡éªŒæ‰€æœ‰å¿…éœ€çš„ç¯å¢ƒå˜é‡ï¼š

```typescript
// src/config/env.ts
const envSchema = z.object({
  NODE_ENV: z.enum(['development', 'production', 'test']),
  PORT: z.string().transform(Number),
  // ... æ›´å¤šé…ç½®
})
```

å¦‚æœç¯å¢ƒå˜é‡ç¼ºå¤±æˆ–æ ¼å¼é”™è¯¯ï¼ŒæœåŠ¡å°†æ‹’ç»å¯åŠ¨ã€‚

### 2. ç»Ÿä¸€å“åº”æ ¼å¼

æ‰€æœ‰ API è¿”å›ç»Ÿä¸€çš„å“åº”ç»“æ„ï¼š

**æˆåŠŸå“åº”**ï¼š
```json
{
  "success": true,
  "data": { ... },
  "message": "æ“ä½œæˆåŠŸï¼ˆå¯é€‰ï¼‰",
  "timestamp": 1234567890
}
```

**å¤±è´¥å“åº”**ï¼š
```json
{
  "success": false,
  "error": {
    "code": "ERROR_CODE",
    "message": "é”™è¯¯æè¿°",
    "details": { ... }
  },
  "timestamp": 1234567890
}
```

### 3. æ’ä»¶ç³»ç»Ÿ

åˆ©ç”¨ Fastify çš„æ’ä»¶ç³»ç»Ÿå®ç°æ¡†æ¶çº§èƒ½åŠ›ï¼š

- `response.ts`: ä¸º Reply æ·»åŠ  `success()` å’Œ `fail()` æ–¹æ³•
- `error-handler.ts`: å…¨å±€é”™è¯¯æ•è·å’Œè½¬æ¢
- `swagger.ts`: è‡ªåŠ¨ç”Ÿæˆ API æ–‡æ¡£

## ğŸ“¦ æ–°å¢ä¸šåŠ¡æ¨¡å—

### æ–¹å¼ 1: å¤åˆ¶ç°æœ‰æ¨¡å—

```bash
# å¤åˆ¶ user æ¨¡å—ä½œä¸ºæ¨¡æ¿
cp -r src/modules/user src/modules/product

# é‡å‘½åæ–‡ä»¶
cd src/modules/product
rename 's/user/product/' *

# ä¿®æ”¹ä»£ç å®ç°ä¸šåŠ¡é€»è¾‘
```

### æ–¹å¼ 2: æ‰‹åŠ¨åˆ›å»º

1. åœ¨ `src/modules/` ä¸‹åˆ›å»ºæ–°ç›®å½•ï¼ˆå¦‚ `order/`ï¼‰
2. åˆ›å»ºå››ä»¶å¥—æ–‡ä»¶ï¼š
   - `order.controller.ts` - æ§åˆ¶å™¨
   - `order.service.ts` - æœåŠ¡å±‚
   - `order.route.ts` - è·¯ç”±å®šä¹‰
   - `order.schema.ts` - Schema å®šä¹‰
3. åœ¨ `order/index.ts` å¯¼å‡ºè·¯ç”±
4. åœ¨ `modules/index.ts` æ³¨å†Œæ¨¡å—

## ğŸ§ª æµ‹è¯•

æµ‹è¯•æ–‡ä»¶ä½äº `tests/` ç›®å½•ï¼Œé•œåƒ `src/` çš„ç»“æ„ï¼š

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pnpm test

# è¿è¡Œå•ä¸ªæµ‹è¯•æ–‡ä»¶
pnpm test tests/modules/user.test.ts

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
pnpm test:coverage
```

## ğŸ”§ è‡ªå®šä¹‰é…ç½®

### TypeScript è·¯å¾„åˆ«å

å·²é…ç½® `@/` ä½œä¸º `src/` çš„åˆ«åï¼š

```typescript
import { config } from '@/config'
import { UserService } from '@/modules/user'
```

### æ—¥å¿—é…ç½®

å¼€å‘ç¯å¢ƒä½¿ç”¨ `pino-pretty` ç¾åŒ–æ—¥å¿—è¾“å‡ºï¼Œç”Ÿäº§ç¯å¢ƒè¾“å‡º JSON æ ¼å¼ã€‚

## ğŸš¢ ç”Ÿäº§éƒ¨ç½²

### 1. æ„å»º

```bash
pnpm build
```

æ„å»ºäº§ç‰©ä½äº `dist/` ç›®å½•ã€‚

### 2. é…ç½®ç¯å¢ƒå˜é‡

ç¡®ä¿ç”Ÿäº§ç¯å¢ƒçš„ `.env` æ–‡ä»¶åŒ…å«ï¼š

```bash
NODE_ENV=production
PORT=3000
SWAGGER_ENABLED=false
```

### 3. å¯åŠ¨æœåŠ¡

```bash
pnpm start
```

æˆ–ä½¿ç”¨ PM2ï¼š

```bash
pm2 start dist/server.js --name backend-forge
```

## ğŸ“– è®¾è®¡åŸåˆ™

æœ¬è„šæ‰‹æ¶éµå¾ªä»¥ä¸‹è®¾è®¡åŸåˆ™ï¼š

1. **æ¸…æ™°ä¼˜å…ˆäºæŠ€å·§**: ä»£ç ç»“æ„æ˜“äºç†è§£ï¼Œæ–°äººå¯å¿«é€Ÿä¸Šæ‰‹
2. **åŠŸèƒ½æ¨¡å—åŒ–**: æŒ‰ä¸šåŠ¡åŠŸèƒ½ç»„ç»‡ä»£ç ï¼Œè€ŒéæŠ€æœ¯åˆ†å±‚
3. **æœ€å°ä½†å®Œæ•´**: æä¾›å¿…è¦èƒ½åŠ›ï¼Œä½†ä¸è¿‡åº¦è®¾è®¡
4. **æ˜“äºæ‰©å±•**: ç”¨æˆ·å¯æ ¹æ®éœ€æ±‚è‡ªç”±æ‰©å±•
5. **ç¬¦åˆ Fastify å“²å­¦**: æ’ä»¶ä¼˜å…ˆï¼Œå……åˆ†åˆ©ç”¨ Fastify ç‰¹æ€§

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿è´¡çŒ®ï¼è¯·ç¡®ä¿ï¼š

- éµå¾ªç°æœ‰ä»£ç é£æ ¼
- è¡¥å……å¿…è¦çš„æµ‹è¯•
- æ›´æ–°ç›¸å…³æ–‡æ¡£

## ğŸ“„ è®¸å¯è¯

[MIT License](LICENSE)

## ğŸ™‹ å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆä¸ç”¨ NestJSï¼Ÿ

A: NestJS æ˜¯ä¼˜ç§€çš„æ¡†æ¶ï¼Œä½†æœ¬è„šæ‰‹æ¶è¿½æ±‚æ›´è½»é‡ã€æ›´è´´è¿‘ Fastify åŸç”Ÿçš„å¼€å‘ä½“éªŒã€‚

### Q: å¯ä»¥ä½¿ç”¨æŠ€æœ¯åˆ†å±‚æ¨¡å¼å—ï¼Ÿ

A: å¯ä»¥ï¼æ‚¨å¯ä»¥è‡ªè¡Œè°ƒæ•´ä¸º `controllers/` + `services/` ç»“æ„ï¼Œè„šæ‰‹æ¶ä¸å¼ºåˆ¶ã€‚

### Q: å¦‚ä½•é›†æˆæ•°æ®åº“ï¼Ÿ

A: æœ¬è„šæ‰‹æ¶æœªé¢„è£…æ•°æ®åº“ï¼Œå½“å‰ä½¿ç”¨å†…å­˜æ•°ç»„ä½œä¸ºæ¼”ç¤ºã€‚æ‚¨å¯ä»¥æ ¹æ®éœ€æ±‚é€‰æ‹©ï¼š

**æ¨èæ–¹æ¡ˆ 1: Prisma**ï¼ˆç±»å‹å®‰å…¨ï¼Œè‡ªåŠ¨ç”Ÿæˆç±»å‹ï¼‰
```bash
pnpm add prisma @prisma/client
pnpm prisma init
```

**æ–¹æ¡ˆ 2: TypeORM**ï¼ˆæˆç†Ÿ ORMï¼Œè£…é¥°å™¨è¯­æ³•ï¼‰
```bash
pnpm add typeorm pg reflect-metadata
```

**æ–¹æ¡ˆ 3: Mongoose**ï¼ˆMongoDB å®˜æ–¹æ¨èï¼‰
```bash
pnpm add mongoose
```

ğŸ“š **è¯¦ç»†é›†æˆæŒ‡å—**ï¼š[docs/database-integration.md](./docs/database-integration.md)

è¯¥æ–‡æ¡£åŒ…å«ï¼š
- å®Œæ•´çš„å®‰è£…æ­¥éª¤
- Schema/Entity å®šä¹‰ç¤ºä¾‹
- Service å±‚æ”¹é€ ç¤ºä¾‹
- Repository æ¨¡å¼ï¼ˆè¿›é˜¶ï¼‰
- è¿ç§»å’Œç§å­æ•°æ®

### Q: ä¸ºä»€ä¹ˆä¸é¢„è£…æ•°æ®åº“ï¼Ÿ

A: ä¸åŒé¡¹ç›®çš„æ•°æ®åº“éœ€æ±‚å·®å¼‚å¾ˆå¤§ï¼ˆPostgreSQL/MySQL/MongoDB/æ— æ•°æ®åº“ç­‰ï¼‰ï¼Œé¢„è£…ä¼šå¢åŠ ä¸å¿…è¦çš„ä¾èµ–ã€‚ä¿æŒè„šæ‰‹æ¶è½»é‡ï¼Œè®©æ‚¨è‡ªç”±é€‰æ‹©æœ€é€‚åˆçš„æ–¹æ¡ˆã€‚

### Q: å¦‚ä½•æ·»åŠ è®¤è¯ï¼Ÿ

A: åˆ›å»º `auth` æ’ä»¶æˆ–ä¸­é—´ä»¶ï¼Œåœ¨ `app.ts` ä¸­æ³¨å†Œï¼Œå‚è€ƒç°æœ‰æ’ä»¶å®ç°ã€‚

---

**Happy Coding! ğŸ‰**
